#文档数据库

##文档数据库定义
“文档”是文档数据库中的主要概念，该数据库可存放并获取文档，其格式可以是XML、JSON、BSON等。这些文档具备自述性，呈现分层的树状数据，可包含映射表、集合和纯量值。文档数据库可视为其值可查的键值数据库，值为“文档”。

注：文档数据库的文档没有空属性。

流行的文档数据库有：

* MongoDB[MongoDB]
* CouchDB[CouchDB]
* Terrastore[Terrastore]
* OrientDB[OrientDB]
* RavenDB[RavenDB]
* Lotus Notes[Lotus Notes]
##特性

* [一致性](dconsistency.md)
* [事务](daffair.md)
* [可用性](dusability.md)
* [查询功能](dquery.md)
* [可扩展性](dexpansibility.md)
###一致性
为了在MongoDB数据库中确保“一致性”，可以配置“副本集”，也可以规定写入操作必须等待所写数据复制到全部或是给定数量的从节点之后，才能返回。每次写入数据时，都可以指定写入操作返回之前，必须将所写数据传播到多少个服务器节点上。

可用类似db.runCommand({getlasterror: 1, w: "majority"})这样的命令指定数据库的“一致性”强度。

>这里的w:"majority"是说：在只有一台服务器时如果指定w为majority，那么写入操作就会立即停止，因为总共只有一个节点；若“副本集”中有三个节点，那么写入操作必须至少在两个节点上执行完毕才会视为成功。所以提高w值，可增“一致性”强度，但写入操作效率会降低。
###事务
在关系型数据库中，我们操作失败之后可以改，改了之后commit提交修改，或是直接回滚，在NoSQL中则没有这些机制，它的写入操作要么成功要么失败。

原子事务：“单文档级别的事务”，一般无法执行多个操作。

###可用性
文档数据库视图用主从式数据复制技术来增强“可用性”。

MongoDB通过“副本集”实现复制，以提高“可用性”。

副本集中至少有两个节点参与“异步主从式复制”。

副本集通常用于处理“数据冗余”，“自动故障切换”，“读取能力扩展”，“无需停机的服务器维护”，“灾难恢复”等。

###查询功能
* CouchDB通过视图查询：可用“物化视图”或“动态视图”。好处是可查询文档中的数据，而不用像键值数据库那样必须根据关键字获取整个文档，然后再检视其内容。
* MongoDB支持一种JSON格式的查询语言，它的功能包括：
>用MYMquery实现where子句和用MYMorderby对数据排序等
###可扩展性
* 这里的“扩展”是指在不讲数据库迁移到更大电脑的前提下，向其中新增节点或修改其内容。

* 增加更多的“读取节点”，将全部读取操作都导引至从节点上，这样就可以扩展数据库应对频繁读取的能力了。

* 若想扩展写入能力，则用“分片”。

* 为了让各分片保持负载均衡，需要在节点之间动态转移数据。
##适用案例
* 事件记录，因为数据类型会变

* 内容管理系统及博客平台，因为没有预设模式，且支持JSON文档

* 网站分析与实时分析，因为可存储实时分析数据
* 电子商务应用程序
##不适用场合
* 包含多项操作的复杂事务

* 查询持续变化的聚合结构

